# FrancoDB Installer Guide - FULLY REDESIGNED âœ¨

## Overview
The FrancoDB installer has been **completely redesigned** to provide a professional, production-ready installation experience with full configuration wizard, Windows Service integration, and proper system setup.

## ğŸ¯ What's New

### âœ… Professional Installation Wizard
1. **Welcome Page** - Clear introduction with feature overview
2. **Port Configuration** - Interactive port selection with validation (1024-65535)
3. **Administrator Credentials** - Secure username/password setup with validation
4. **Encryption Options** - Three choices:
   - No encryption (fastest, less secure)
   - Auto-generated 256-bit key (recommended) - Generates and displays key
   - Custom encryption key (advanced) - User provides their own key
5. **Input Validation** - All fields validated before proceeding

### âœ… Windows Service (NEW!)
- **Replaced unreliable VBS/BAT scripts with proper Windows Service**
- Service name: `FrancoDBService`
- Auto-starts on Windows boot
- Automatic crash detection and restart
- Graceful shutdown handling (tries Ctrl+C, then terminate)
- Windows Event Log integration for monitoring
- Proper service lifecycle management

### âœ… System Integration
- âœ… Adds `bin\` to system PATH (run `francodb_shell` from anywhere)
- âœ… Creates Start Menu shortcuts (Shell, Config Editor, Uninstaller)
- âœ… Auto-creates data directory
- âœ… Generates configuration file from user input
- âœ… Modern installer UI with icon support

### âŒ Removed
- `start_server.vbs` (unreliable)
- `stop_server.bat` (unreliable)  
- `refresh_env.bat` (not needed)

## ğŸ”§ Building the Installer

### Prerequisites
- **CMake** 3.10+
- **C++ Compiler** (MinGW-GCC or MSVC)
- **Inno Setup** from https://jrsoftware.org/isdl.php

### Step 1: Build Executables
```bash
# Configure for Release
cmake -B cmake-build-release -DCMAKE_BUILD_TYPE=Release

# Build all targets
cmake --build cmake-build-release --config Release -j 4
```

**Output:**
- `francodb_server.exe` - Database server
- `francodb_shell.exe` - Interactive CLI
- `francodb_service.exe` - **NEW** Windows service wrapper
- `francodb_setup.exe` - Standalone setup tool (optional)

### Step 2: Compile Installer
1. Open `installer.iss` in Inno Setup Compiler
2. Click **Build** â†’ **Compile**
3. Output: `Output/FrancoDB_Setup.exe`

## ğŸ“¦ Installation Process

### User Experience
1. **Run** `FrancoDB_Setup.exe` (requires Administrator)
2. **Welcome** - See what will be installed
3. **Select Directory** - Default: `C:\Program Files\FrancoDB`
4. **Configure Port** - Default 2501, validates availability
5. **Set Credentials** - Username (min 3 chars), Password (min 4 chars)
6. **Choose Encryption:**
   - None
   - Auto-generate key â†’ **Shows popup with key to save!**
   - Custom key (64 hex chars)
7. **Install** - Copies files, creates config, registers service
8. **Start Service** - Automatically starts FrancoDB

### What Gets Installed
```
C:\Program Files\FrancoDB\
â”œâ”€â”€ bin\
â”‚   â”œâ”€â”€ francodb_server.exe    (Database engine)
â”‚   â”œâ”€â”€ francodb_shell.exe     (Client shell)
â”‚   â”œâ”€â”€ francodb_service.exe   (Service wrapper)
â”‚   â””â”€â”€ francodb.conf          (Generated config)
â””â”€â”€ data\                      (Database files)
```

### Configuration File Generated
```ini
# FrancoDB Configuration File
# Generated by FrancoDB Installer
# 2026-01-14 22:30:00

port = 2501
root_username = "admin"
root_password = "your_secure_password"
data_directory = "../data"
encryption_enabled = true
encryption_key = "auto_generated_64_char_hex_key_here_if_enabled"
autosave_interval = 30
```

## ğŸš€ Using FrancoDB

### Connect to Database
```bash
# From anywhere (added to PATH):
francodb_shell

# Connect with credentials
francodb_shell -h localhost -p 2501 -u admin -P your_password
```

### Service Management
```cmd
# Start service
sc start FrancoDBService

# Stop service
sc stop FrancoDBService

# Check status
sc query FrancoDBService

# Restart service
sc stop FrancoDBService && sc start FrancoDBService
```

### View Logs
1. Open **Event Viewer** (eventvwr.msc)
2. Navigate to **Windows Logs** â†’ **Application**
3. Filter by Source: **FrancoDBService**

## ğŸ”’ Security Notes

### Encryption Key Management
- **Auto-generated keys are shown ONCE during installation**
- Save the key immediately in a secure location
- Without the key, encrypted data cannot be recovered
- Key is stored in `francodb.conf` (secure this file!)

### Credentials
- Root password is stored in config file (hashed in future version)
- Use strong passwords (current minimum: 4 chars)
- Secure the configuration file with NTFS permissions

### Service Security
- Service runs as LOCAL SYSTEM (required for Windows Service)
- Data directory should have restricted permissions
- Consider firewall rules for port access

## ğŸ› Troubleshooting

### Service Won't Start
1. Check Event Viewer for errors
2. Verify config file exists and is valid
3. Check port availability: `netstat -ano | findstr :2501`
4. Ensure data directory is writable

### Port Already in Use
```bash
# Find process using port
netstat -ano | findstr :2501

# Change port in config
notepad "C:\Program Files\FrancoDB\bin\francodb.conf"

# Restart service
sc stop FrancoDBService && sc start FrancoDBService
```

### Can't Connect
- Verify service is running: `sc query FrancoDBService`
- Check firewall settings
- Verify credentials in `francodb.conf`
- Try connecting locally first: `francodb_shell -h localhost`

## ğŸ—ï¸ Technical Details

### Service Architecture
```
Windows Service Controller
    â†“ manages
FrancoDBService (francodb_service.exe)
    â†“ spawns & monitors
francodb_server.exe
    â†“ reads
francodb.conf
    â†“ stores data in
data/francodb.db
```

### Service Wrapper Features
- Process monitoring with 1-second check interval
- Automatic restart on crash
- Graceful shutdown (10-second timeout)
- Event logging for all operations
- Handles Ctrl+C, SIGTERM, console close events

### Files Modified
- âœ… `installer.iss` - Complete rewrite with 5 wizard pages
- âœ… `src/cmd/service/service_wrapper.cpp` - NEW Windows service
- âœ… `CMakeLists.txt` - Added service build target
- âœ… `INSTALLER_README.md` - Complete documentation

## ğŸ“ Uninstallation
1. Use **Add or Remove Programs** in Windows Settings
2. Or run uninstaller from Start Menu
3. Service is automatically stopped and removed
4. Files and data directory are deleted
5. PATH is cleaned up

## ğŸš€ Next Steps
After installation:
1. âœ… Service is running
2. âœ… Open `francodb_shell` from any terminal
3. âœ… Connect with your credentials
4. âœ… Start creating databases!

## ğŸ“š Further Reading
- See `docs/` for database usage guide
- Check `examples/` for SDK usage (C++, Python, Node.js)
- Visit project wiki for advanced topics

## ğŸ™Œ Credits
FrancoDB - High-performance relational database management system
